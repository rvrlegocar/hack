-- Function to find the closest player to the camera, excluding the local player
local function findClosestPlayer()
    local closestPlayer = nil
    local closestDistance = math.huge
    local localPlayer = game.Players.LocalPlayer  -- Get the local player
    
    for _, player in ipairs(game.Players:GetPlayers()) do
        if player ~= localPlayer then  -- Skip the local player
            local character = player.Character
            local head = character and character:FindFirstChild("Head")
            
            if head then
                local distance = (game.Workspace.CurrentCamera.CFrame.p - head.Position).magnitude
                if distance < closestDistance then
                    closestDistance = distance
                    closestPlayer = player
                end
            end
        end
    end
    
    return closestPlayer
end

-- Function to calculate camera offset dynamically based on distance
local function calculateOffset(target)
    local head = target.Character and target.Character:FindFirstChild("Head")
    if head then
        local distance = (game.Workspace.CurrentCamera.CFrame.p - head.Position).magnitude
        local yOffset = -distance * 0.08  -- Adjust the multiplier to control the offset
        return yOffset
    end
    return 0
end

-- Function to update camera position to look at a target player's head with offset
local function updateCamera(targetPlayer)
    local head = targetPlayer.Character and targetPlayer.Character:FindFirstChild("Head")
    if head then
        local targetPosition = head.Position + Vector3.new(0, calculateOffset(targetPlayer), 0)
        game.Workspace.CurrentCamera.CFrame = CFrame.new(game.Workspace.CurrentCamera.CFrame.p, targetPosition)
    end
end

-- Initial setup: Find the closest player and focus on them initially
local initialTarget = findClosestPlayer()
if initialTarget then
    updateCamera(initialTarget)
else
    print("No players found.")
end

-- Connect the update function to render step to continuously update camera position
game:GetService("RunService").RenderStepped:Connect(function()
    local closestPlayer = findClosestPlayer()
    if closestPlayer then
        updateCamera(closestPlayer)
    end
end)

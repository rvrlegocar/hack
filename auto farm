-- Define a variable to track if the loop is running
local isLoopRunning = true

-- Function to toggle the loop on/off
local function toggleLoop()
    isLoopRunning = not isLoopRunning
    if isLoopRunning then
        checkForLootAndItems()
    end
end

-- Create a ScreenGui instance
local screenGui = Instance.new("ScreenGui")
screenGui.Parent = game.Players.LocalPlayer.PlayerGui

-- Create a TextButton at the top left corner of the screen
local button = Instance.new("TextButton")
button.Text = "Toggle Loop"
button.Size = UDim2.new(0, 120, 0, 50)
button.Position = UDim2.new(0.01, 0, 0.01, 0)  -- 1% from the left and top edge
button.Parent = game.Players.LocalPlayer.PlayerGui.ScreenGui  -- Replace 'ScreenGui' with your actual ScreenGui instance

-- Connect button click event to toggle function
button.MouseButton1Click:Connect(toggleLoop)

-- Function to interact with items
local function interactWithItem(item)
    if item:IsA("BasePart") then
        game.Players.LocalPlayer.Character:SetPrimaryPartCFrame(CFrame.new(item.Position))
        wait(0.1)
        
        -- Look downward after teleporting
        local humanoid = game.Players.LocalPlayer.Character.Humanoid
        local rootPart = humanoid.RootPart
        local camera = game.Workspace.CurrentCamera
        
        local rootPosition = rootPart.Position
        local lookAtPosition = rootPosition - Vector3.new(0, 10, 0) -- Adjust the downward offset as needed
        
        camera.CFrame = CFrame.new(camera.CFrame.Position, lookAtPosition)
        wait(0.1)
        
        -- Check for proximity prompt (assuming it's named "ProximityPrompt")
        local proximityPrompt = item:FindFirstChild("ProximityPrompt")
        if proximityPrompt then
            proximityPrompt:InputHoldBegin(Enum.KeyCode.E)
            wait(0.7)
            proximityPrompt:InputHoldEnd(Enum.KeyCode.E)
        end
    end
end

-- Function to check for loot and items
local function checkForLootAndItems()
    if not isLoopRunning then
        return
    end
    
    local workspace = game:GetService("Workspace")
    local storagesFolder = workspace:FindFirstChild("Storages")

    if storagesFolder then
        while true do
            for _, item in pairs(storagesFolder:GetChildren()) do
                if item:IsA("Model") and item.Name == "Room" then
                    local contentsFolder = item:FindFirstChild("Contents")
                    if contentsFolder then
                        local lootFolder = contentsFolder:FindFirstChild("Loot")
                        if lootFolder then
                            for _, lootItem in pairs(lootFolder:GetChildren()) do
                                interactWithItem(lootItem)
                            end
                        end

                        local itemsFolder = contentsFolder:FindFirstChild("Items")
                        if itemsFolder then
                            for _, itemItem in pairs(itemsFolder:GetChildren()) do
                                interactWithItem(itemItem)
                            end
                        end
                    end
                end
            end
            wait(0.1)  -- Adjust wait time between checks as needed
        end
    else
        print("Storages folder not found in Workspace.")
    end
end

-- Connect to CharacterAdded event to start checking for loot and items
game.Players.LocalPlayer.CharacterAdded:Connect(checkForLootAndItems)

-- Start checking for loot and items immediately if character already exists
if game.Players.LocalPlayer.Character then
    checkForLootAndItems()
end
